<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <!-- Íconos de Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="../css/style.css">
  <title>Carro de compras</title>
</head>

<body>
  <!-- Contenedor principal del carrito -->
     <div class="cart-container">
    <h2>Cart</h2>
    
      <!-- Tabla de productos del carrito -->
    <table>
      <thead>
        <tr>
          <th>Product</th>
          <th>Price</th>
          <th>Quantity</th>
          <th>Subtotal</th>
        </tr>
      </thead>
      <tbody id="cart-items"></tbody>
    </table>

     <!--Acciones debajo de la tabla-->
    <div class="actions">
     <button class="btn-outline" onclick="returnToShop()">Return To Shop</button>
      <button class="btn-outline" onclick="updateCart()">Update Cart</button>
    </div>

    <!--Cupon de descuento -->
    <div class="coupon">
      <input type="text" placeholder="Coupon Code" />
      <button class="btn">Apply Coupon</button>
    </div>
    <!-- Total del carrito  -->
    <div class="summary">
      <div class="summary-box">
        <div><strong>Cart Total</strong></div>
        <div><span>Subtotal:</span><span id="subtotal">$0</span></div>
        <div><span>Shipping:</span><span>Free</span></div>
        <div><span>Total:</span><strong id="total">$0</strong></div>
        <button class="btn">Proceed to checkout</button>
      </div>
    </div>
  </div>
</div>  <!-- Cierre de cart-container -->

  
  
  <script>
// Cargar el carrito al iniciar la página
function cargarCarrito() {
    fetch('../php/carrito_api.php?action=listar') // Solicita los productos en el carrito desde el servidor
        .then(res => res.json()) // Convierte la respuesta a JSON
        .then(data => {
            const contenedor = document.getElementById('cart-items');
            contenedor.innerHTML = ''; // Limpia los productos anteriores
            let total = 0;

            // Recorre cada producto recibido del backend
            data.forEach(item => {
                const subtotal = item.precio * item.cantidad; // Calcula el subtotal por producto
                total += subtotal; // Suma al total general

                // Agrega cada fila del producto al tbody
                contenedor.innerHTML += `
                    <tr>
                        <td>${item.producto}</td>
                        <td>$${item.precio}</td>
                        <td>
                            <input type="number" value="${item.cantidad}" onchange="actualizarCantidad(${item.id}, this.value)">
                        </td>
                        <td class="subtotal">$${subtotal.toFixed(2)}
                            <span class="delete-icon" onclick="eliminarProducto(${item.id})">
                                <i class="fas fa-trash-alt" style="color: #7e00ff; cursor: pointer;"></i>
                            </span>
                        </td>
                    </tr>
                `;
            });

            // Actualiza totales en el resumen
            document.getElementById('subtotal').textContent = `$${total.toFixed(2)}`;
            document.getElementById('total').textContent = `$${total.toFixed(2)}`;
        });
}

  // Actualiza la cantidad en el servisor 
function actualizarCantidad(id, nuevaCantidad) {
    fetch('../php/carrito_api.php?action=actualizar', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: `id=${id}&cantidad=${nuevaCantidad}`
    }).then(() => cargarCarrito());
}

// Eliminar producto del carro 
function eliminarProducto(id) {
    fetch('../php/carrito_api.php?action=eliminar', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: `id=${id}`
    }).then(() => cargarCarrito());
}

window.onload = cargarCarrito; // Llama a cargarCarrito() cuando la página termina de cargar
</script>

</body>
</html>